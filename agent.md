# Cladhunter Engineer Handbook (October 2025)

Рабочий плейбук для инженеров CladHunter. Читайте вместе с `audit.md` (операционные чеклисты), `README.md` (архитектура и запуск) и `docs/PRODUCT_ANALYSIS.md` (продуктовая перспектива).

---

## 1. Архитектура & репозиторий

| Layer    | Stack / Tooling                                   | Hosting |
|----------|---------------------------------------------------|---------|
| Frontend | React 18, TypeScript, Vite, Tailwind, TonConnect  | Vercel  |
| Backend  | Node 18, Express, Zod, pg, express-rate-limit     | Render  |
| Database | PostgreSQL (Neon)                                 | Neon    |
| Shared   | TypeScript configs (ads, economy, partners)       | Shared  |

```
.
|--- backend/             # Express API, Ton integrations, services
|--- frontend/            # Vite + React mini-app (Mining, Stats, Wallet)
|--- shared/config/       # Ads, economy, partner campaign definitions
\--- docs/                # Deployment, product, research
```

Основной поток: фронт запрашивает тон-пруф (`GET /api/auth/ton-connect/challenge`), кошелёк подписывает, backend проверяет (`POST /api/auth/ton-connect`), далее клиенты обращаются к API с `{ userId, accessToken, walletAddress }`.

---

## 2. Рабочий цикл

1. В начале недели обновите `audit.md` (Фаза 0) и проверьте блокеры.
2. На каждую задачу создавайте заметку с чеклистом → после завершения отмечайте пункт в `audit.md`, добавляйте ссылку на PR/тикет.
3. Изменения архитектуры/флоу фиксируйте сразу в `README.md` и профильных документах (`docs/DEPLOYMENT.md`, `docs/PRODUCT_ANALYSIS.md`). Док неактуален → команда путается.
4. Перед марджем: локально гоните тесты, ESLint/TypeScript, затем smoke-тест из `docs/DEPLOYMENT.md` при деплое.
5. Релиз описывайте в release log + обновляйте раздел «Changelog» соответствующих файлов.

---

## 3. Backend (Express API)

- Входные данные валидируются Zod схемами перед бизнес-логикой.
- Сервисы (`backend/src/services`) не должны «знать» о HTTP. Возвраты — в виде структурированных объектов/ошибок.
- Логируйте ключевые события (`auth`, `ads/complete`, `orders`) через единый helper, добавляйте `userId`, `walletAddress`, `requestId`.
- Транзакции с pg используйте для операций, которые изменяют больше одной таблицы (например, начисление энергии + лог).
- Ошибки всегда мапьте в код + сообщение для клиента (RU/EN). Сырые текстовые ошибки запрещены.
- Набор эндпоинтов закреплён в `README.md` → изменения синхронизируйте с фронтом и документацией.

---

## 4. Frontend (Vite + React)

- `useAuth` отвечает за хранение `{ userId, accessToken, walletAddress }`. Любая работа с API должна идти через клиент, который подтягивает эти значения в заголовки.
- `MiningScreen` и `Stats` обязаны обрабатывать состояния ошибок/таймаутов с дружелюбными сообщениями. При обновлении экономики обновляйте `shared/config/ads.ts` и UI одновременно.
- Интеграция TonConnect: держите `tonProof` актуальным, отслеживайте disconnect (нужно очищать токены и баланс).
- Стейт по бустам и наградам синхронизируйте с backend ответами, не полагайтесь на локальные вычисления.
- Все пользовательские тексты должны жить в ресурсе/словаре (готовим RU/EN локализацию).

---

## 5. Тестирование и качество

- Planned stack: Vitest (frontend), Jest + supertest (backend). До внедрения минимум — ручная проверка по smoke-тест чеклисту из `docs/DEPLOYMENT.md`.
- Любой баг → добавьте regression task в `audit.md` (Фаза 7) и выделите тест-кейс.
- Линтеры (`eslint`, `tsc --project`) запускайте локально перед PR.
- При сложных изменениях пишите «техническую заметку» в PR описании: что меняется, как проверить.

---

## 6. Наблюдаемость и тревоги

- Render logs: первая точка диагностики для backend. Включайте `DEBUG` режим при отладке (без логирования чувствительных данных).
- Neon: проверяйте состояние через консоль или `SELECT count(*)` по таблицам. Log запросы для тонких багов.
- Мониторинг: `/api/health` + собственные метрики (`ads/complete`, `orders/confirmed`). Алерты на внезапный рост/падение.
- Сторонние сервисы: TonAPI webhook (проверяйте подпись), TonConnect SDK (обновляйте при мажорных релизах).

---

## 7. Известные задачи (актуально 2025-10-31)

- Расследовать TonConnect привязку (кошелёк не сохраняется). Подробности — `audit.md` → блокер.
- Внедрить webhook TonAPI в проде.
- Подготовить onboarding и RU/EN локализацию UI.
- Выбрать и внедрить analytics SDK (см. `docs/PRODUCT_ANALYSIS.md` → раздел 4).
- Собрать launch kit (Landing, Telegram канал, partner deck).

Эти пункты должны отражаться в таск-трекере и чеклистах.

---

## 8. Коммуникации

- Daily sync: короткий апдейт (что сделано, что дальше, блокеры). Ссылка на обновлённые чекбоксы в `audit.md` приветствуется.
- Release log: храните ссылку на PR, commit hash, результаты smoke теста, метрики после релиза.
- Посторонние запросы (маркетинг, партнёры, комьюнити) направляйте в product lead, фиксируйте решение в docs.

---

## Changelog

- 2025-10-31 — плейбук синхронизирован с новой чеклистовой структурой, добавлены рабочий цикл и актуальные задачи.

